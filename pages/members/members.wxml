<!--pages/members/members.wxml-->
<view class="container">
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-container">
    <view class="stat-item">
      <text class="stat-number">{{totalMembers}}</text>
      <text class="stat-label">æ€»ä¼šå‘˜</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{maleCount}}</text>
      <text class="stat-label">ç”·æ€§</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{femaleCount}}</text>
      <text class="stat-label">å¥³æ€§</text>
    </view>
    <view class="stat-item filter-item" bindtap="toggleFilterPanel">
      <text class="stat-icon">ğŸ”</text>
      <text class="stat-label">ç­›é€‰</text>
      <text class="arrow {{showFilterPanel ? 'arrow-up' : ''}}">â–¼</text>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <!-- ä¼šå‘˜ç¼–å·ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-section-title">ä¼šå‘˜ç¼–å·</view>
      <input 
        class="member-id-input" 
        type="text" 
        placeholder="è¯·è¾“å…¥ä¼šå‘˜ç¼–å·" 
        value="{{memberId}}"
        bindinput="onMemberIdInput"
      />
    </view>

    <!-- å¹´é¾„æ®µç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-section-title">å¹´é¾„</view>
      <view class="filter-options">
        <view 
          wx:for="{{ageOptions}}" 
          wx:key="index" 
          class="filter-option {{selectedAgeRange === item ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="selectAgeRange"
        >
          {{item}}
        </view>
      </view>
      <view class="custom-input-row">
        <input 
          class="custom-input" 
          type="number" 
          placeholder="æœ€å°" 
          value="{{ageMin}}"
          data-field="min"
          data-type="age"
          bindinput="onAgeInput"
        />
        <text class="input-separator">-</text>
        <input 
          class="custom-input" 
          type="number" 
          placeholder="æœ€å¤§" 
          value="{{ageMax}}"
          data-field="max"
          data-type="age"
          bindinput="onAgeInput"
        />
        <text class="input-unit">å²</text>
      </view>
    </view>

    <!-- æ€§åˆ«ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-section-title">æ€§åˆ«</view>
      <view class="filter-options">
        <view 
          wx:for="{{genderOptions}}" 
          wx:key="index" 
          class="filter-option {{selectedGender === item ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="selectGender"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- èº«é«˜ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-section-title">èº«é«˜</view>
      <view class="filter-options">
        <view 
          wx:for="{{heightOptions}}" 
          wx:key="index" 
          class="filter-option {{selectedHeightRange === item ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="selectHeightRange"
        >
          {{item}}
        </view>
      </view>
      <view class="custom-input-row">
        <input 
          class="custom-input" 
          type="number" 
          placeholder="æœ€å°" 
          value="{{heightMin}}"
          data-field="min"
          data-type="height"
          bindinput="onHeightInput"
        />
        <text class="input-separator">-</text>
        <input 
          class="custom-input" 
          type="number" 
          placeholder="æœ€å¤§" 
          value="{{heightMax}}"
          data-field="max"
          data-type="height"
          bindinput="onHeightInput"
        />
        <text class="input-unit">cm</text>
      </view>
    </view>

    <!-- å­¦å†ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-section-title">å­¦å†</view>
      <view class="filter-options">
        <view 
          wx:for="{{educationOptions}}" 
          wx:key="index" 
          class="filter-option {{selectedEducation === item ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="selectEducation"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="filter-buttons">
      <button class="btn btn-secondary" bindtap="resetFilter">é‡ç½®</button>
      <button class="btn btn-primary" bindtap="confirmFilter">ç¡®å®š</button>
    </view>
  </view>

  <!-- ä¼šå‘˜åˆ—è¡¨ -->
  <view wx:if="{{members.length > 0}}">
    <view wx:for="{{members}}" wx:key="id" class="member-card" bindtap="showMemberDetail" data-id="{{item.id}}">
      <view class="member-header">
        <text class="member-name">{{item.name}}</text>
        <text class="member-gender {{item.gender === 'ç”·' ? 'male' : 'female'}}">{{item.gender}}</text>
      </view>
      
      <view class="member-info">
        <view class="member-info-item">
          <text class="member-info-label">ä¼šå‘˜ç¼–å·</text>
          <text class="member-info-value">{{item.memberId || 'æœªå¡«å†™'}}</text>
        </view>
        <view class="member-info-item">
          <text class="member-info-label">å¹´é¾„</text>
          <text class="member-info-value">{{item.age}}å²</text>
        </view>
        <view class="member-info-item">
          <text class="member-info-label">èº«é«˜</text>
          <text class="member-info-value">{{item.height ? item.height + 'cm' : 'æœªå¡«å†™'}}</text>
        </view>

        <view class="member-info-item">
          <text class="member-info-label">è”ç³»ç”µè¯</text>
          <text class="member-info-value">{{item.phone || 'æœªå¡«å†™'}}</text>
        </view>
        <view class="member-info-item">
          <text class="member-info-label">èŒä¸š</text>
          <text class="member-info-value">{{item.occupation}}</text>
        </view>
        <view class="member-info-item">
          <text class="member-info-label">æ”¶å…¥</text>
          <text class="member-info-value">{{item.income}}</text>
        </view>
        <view class="member-info-item">
          <text class="member-info-label">å­¦å†</text>
          <text class="member-info-value">{{item.education}}</text>
        </view>
        <view class="member-info-item">
          <text class="member-info-label">å…„å¼Ÿæƒ…å†µ</text>
          <text class="member-info-value">{{item.siblings}}</text>
        </view>
      </view>
      
      <view wx:if="{{item.requirements}}" class="member-requirements">
        <text class="label">æ‹©å¶è¦æ±‚ï¼š</text>{{item.requirements}}
      </view>
      
      <view class="action-buttons">
        <button class="btn btn-secondary btn-small" catchtap="editMember" data-id="{{item.id}}">ç¼–è¾‘</button>
        <button class="btn btn-danger btn-small" catchtap="deleteMember" data-id="{{item.id}}" data-cloudrecordid="{{item.cloudRecordId}}">åˆ é™¤</button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <text class="empty-icon">ğŸ‘¥</text>
    <view class="empty-title">æš‚æ— ä¼šå‘˜ä¿¡æ¯</view>
    <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹"æ·»åŠ ä¼šå‘˜"å¼€å§‹å½•å…¥</view>
  </view>
</view>

<!-- åŠ è½½æ›´å¤š -->
<view class="load-more" wx:if="{{hasMore}}">
  <text>åŠ è½½ä¸­...</text>
</view>